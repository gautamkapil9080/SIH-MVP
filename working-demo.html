<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSE-D Telemedicine - Rural Healthcare Access</title>
    <!-- Updated: 2025-01-15 13:28 - Patient Portal with Registration & Login -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        .navbar {
            background: #2E8B57;
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-brand h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .nav-links button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-links button:hover, .nav-links button.active {
            background: rgba(255,255,255,0.3);
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .language-selector select {
            padding: 5px;
            border-radius: 4px;
        }

        .section {
            display: none;
            padding: 2rem;
            min-height: 80vh;
        }

        .section.active {
            display: block;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            background: #2E8B57;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn:hover {
            background: #236B43;
        }

        .emergency-btn {
            background: #dc3545;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .symptom-btn {
            padding: 1rem;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .symptom-btn.selected {
            border-color: #2E8B57;
            background: #e8f5e8;
        }

        .medicine-result {
            background: #f8f9fa;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            border-left: 4px solid #2E8B57;
        }

        .status-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            border-radius: 4px;
            display: none;
            z-index: 1001;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Patient Portal Tabs */
        .patient-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e9ecef;
        }

        .patient-tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
            color: #6c757d;
            transition: all 0.3s;
        }

        .patient-tab-btn.active {
            color: #2E8B57;
            border-bottom-color: #2E8B57;
            font-weight: bold;
        }

        .patient-tab-btn:hover {
            color: #2E8B57;
            background: rgba(46, 139, 87, 0.1);
        }

        .patient-tab-content {
            display: none;
        }

        .patient-tab-content.active {
            display: block;
        }

        /* Enhanced Form Styling */
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .medical-info-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border: 1px solid #dee2e6;
        }

        .medical-info-section h4 {
            color: #2E8B57;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .patient-profile {
            background: #e8f5e8;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #2E8B57;
        }

        .patient-profile h3 {
            color: #2E8B57;
            margin-bottom: 1rem;
        }

        .profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .profile-item {
            background: white;
            padding: 0.75rem;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        .profile-item strong {
            color: #2E8B57;
            display: block;
            margin-bottom: 0.25rem;
        }

        /* AI Chatbot Styles */
        .chatbot-container {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 1rem;
            background: #f8f9fa;
            margin: 1rem 0;
        }

        .chat-message {
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
        }

        .chat-message.ai {
            justify-content: flex-start;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 15px;
            word-wrap: break-word;
        }

        .message-bubble.ai {
            background: #2E8B57;
            color: white;
            border-bottom-left-radius: 5px;
        }

        .message-bubble.user {
            background: #007bff;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin: 0 0.5rem;
        }

        .ai-avatar {
            background: #2E8B57;
            color: white;
        }

        .user-avatar {
            background: #007bff;
            color: white;
        }

        .chat-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
            justify-content: center;
        }

        .chat-option {
            background: #e9ecef;
            border: 2px solid #dee2e6;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .chat-option:hover {
            background: #2E8B57;
            color: white;
            border-color: #2E8B57;
        }

        .voice-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .voice-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .voice-btn:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .voice-btn.recording {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .typing-indicator {
            display: none;
            align-items: center;
            padding: 0.5rem 1rem;
            color: #6c757d;
            font-style: italic;
        }

        .typing-dots {
            display: inline-block;
            margin-left: 0.5rem;
        }

        .typing-dots span {
            animation: typing 1.4s infinite;
            display: inline-block;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        .diagnosis-result {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border: 2px solid #2E8B57;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .urgency-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }

        .urgency-mild {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .urgency-urgent {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .urgency-emergency {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
            }
            
            .section {
                padding: 1rem;
            }

            .patient-tabs {
                flex-direction: column;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-row .form-group {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <select id="languageSelect">
            <option value="en">English</option>
            <option value="hi">हिंदी (Hindi)</option>
            <option value="te">తెలుగు (Telugu)</option>
        </select>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1 id="app_title">CSE-D Telemedicine</h1>
        </div>
        <div class="nav-links">
            <button onclick="showSection('patient')" id="patient_portal" class="active">Patient Portal</button>
            <button onclick="showSection('doctor')" id="doctor_portal">Doctor Portal</button>
            <button onclick="showSection('pharmacy')" id="pharmacy_portal">Pharmacy Portal</button>
            <button onclick="showSection('symptoms')" id="symptom_checker">Symptom Checker</button>
            <button onclick="showSection('schemes')" id="gov_schemes">Govt Schemes</button>
            <button onclick="showSection('emergency')" id="emergency" class="emergency-btn">🚨 Emergency</button>
        </div>
    </nav>

    <!-- Patient Section -->
    <section id="patient-section" class="section active">
        <div class="container">
            <h2 id="patient_portal_title">Patient Portal</h2>
            
            <!-- Patient Portal Tabs - Updated for Login/Registration -->
            <div class="patient-tabs" style="border: 2px solid #2E8B57; padding: 10px; margin: 10px 0;">
                <button onclick="showPatientTab('registration')" class="patient-tab-btn active" id="tab_registration">📝 Registration</button>
                <button onclick="showPatientTab('login')" class="patient-tab-btn" id="tab_login">🔑 Login</button>
            </div>
            <p style="color: #2E8B57; font-size: 0.9em; margin: 5px 0;">✅ Patient Portal now has both Registration and Login tabs above!</p>

            <!-- Registration Tab -->
            <div id="registration-tab" class="patient-tab-content active">
                <div class="card">
                    <h3 id="patient_registration">Patient Registration</h3>
                    <form id="patientRegistrationForm">
                        <!-- Basic Information -->
                        <h4 id="basic_info">📋 Basic Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label id="full_name">Full Name:</label>
                                <input type="text" id="regPatientName" required>
                            </div>
                            <div class="form-group">
                                <label id="age">Age:</label>
                                <input type="number" id="regPatientAge" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label id="phone">Phone Number:</label>
                                <input type="tel" id="regPatientPhone" required>
                            </div>
                            <div class="form-group">
                                <label id="gender">Gender:</label>
                                <select id="regPatientGender" required>
                                    <option value="" id="select_gender">Select Gender</option>
                                    <option value="male" id="male">Male</option>
                                    <option value="female" id="female">Female</option>
                                    <option value="other" id="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label id="village">Village/Address:</label>
                                <input type="text" id="regPatientVillage" required>
                            </div>
                            <div class="form-group">
                                <label id="password">Password:</label>
                                <input type="password" id="regPatientPassword" required>
                            </div>
                        </div>

                        <!-- Medical Information -->
                        <div class="medical-info-section">
                            <h4 id="medical_info">🩺 Medical Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label id="blood_group">Blood Group:</label>
                                    <select id="regBloodGroup" required>
                                        <option value="" id="select_blood_group">Select Blood Group</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label id="height">Height (cm):</label>
                                    <input type="number" id="regHeight" placeholder="e.g., 170">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label id="weight">Weight (kg):</label>
                                    <input type="number" id="regWeight" placeholder="e.g., 65">
                                </div>
                                <div class="form-group">
                                    <label id="sugar_level">Sugar Level (mg/dL):</label>
                                    <input type="number" id="regSugarLevel" placeholder="e.g., 110">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label id="blood_pressure_systolic">Blood Pressure (Systolic):</label>
                                    <input type="number" id="regBPSystolic" placeholder="e.g., 120">
                                </div>
                                <div class="form-group">
                                    <label id="blood_pressure_diastolic">Blood Pressure (Diastolic):</label>
                                    <input type="number" id="regBPDiastolic" placeholder="e.g., 80">
                                </div>
                            </div>
                        </div>

                        <!-- Medical History -->
                        <div class="form-group">
                            <label id="medical_history">Medical History:</label>
                            <textarea id="regMedicalHistory" rows="3" placeholder="Previous surgeries, chronic conditions, allergies, etc."></textarea>
                        </div>
                        
                        <!-- Current Symptoms -->
                        <div class="form-group">
                            <label id="current_symptoms">Current Symptoms:</label>
                            <textarea id="regCurrentSymptoms" rows="3" placeholder="Describe your current health concerns..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label id="urgency">Urgency Level:</label>
                            <select id="regUrgencyLevel">
                                <option value="low" id="low">Low</option>
                                <option value="medium" id="medium">Medium</option>
                                <option value="high" id="high">High</option>
                                <option value="emergency" id="emergency_level">Emergency</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn" id="register_btn">Register & Submit Request</button>
                    </form>
                </div>
            </div>

            <!-- Login Tab -->
            <div id="login-tab" class="patient-tab-content">
                <div class="card">
                    <h3 id="patient_login">Patient Login</h3>
                    <form id="patientLoginForm">
                        <div class="form-group">
                            <label id="login_phone">Phone Number:</label>
                            <input type="tel" id="loginPhone" required>
                        </div>
                        <div class="form-group">
                            <label id="login_password">Password:</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn" id="login_btn">Login</button>
                    </form>
                </div>
                
                <!-- Patient Profile (shown after login) -->
                <div id="patientProfile" class="patient-profile" style="display: none;">
                    <h3 id="patient_profile_title">👤 Patient Profile</h3>
                    <div class="profile-info">
                        <div class="profile-item">
                            <strong id="profile_name_label">Name:</strong>
                            <span id="profileName">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_age_label">Age:</strong>
                            <span id="profileAge">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_gender_label">Gender:</strong>
                            <span id="profileGender">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_phone_label">Phone:</strong>
                            <span id="profilePhone">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_blood_group_label">Blood Group:</strong>
                            <span id="profileBloodGroup">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_village_label">Address:</strong>
                            <span id="profileVillage">-</span>
                        </div>
                    </div>
                    
                    <h4 id="medical_info_title" style="margin: 1.5rem 0 1rem 0; color: #2E8B57;">🩺 Medical Information</h4>
                    <div class="profile-info">
                        <div class="profile-item">
                            <strong id="profile_height_label">Height:</strong>
                            <span id="profileHeight">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_weight_label">Weight:</strong>
                            <span id="profileWeight">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_sugar_label">Sugar Level:</strong>
                            <span id="profileSugar">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="profile_bp_label">Blood Pressure:</strong>
                            <span id="profileBP">-</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <strong id="profile_history_label">Medical History:</strong>
                        <p id="profileMedicalHistory" style="margin: 0.5rem 0; padding: 1rem; background: white; border-radius: 4px;">-</p>
                    </div>
                    
                    <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                        <button onclick="requestConsultation()" class="btn" id="request_consultation_btn">Request New Consultation</button>
                        <button onclick="logoutPatient()" class="btn" style="background: #6c757d;" id="logout_btn">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Doctor Section -->
    <section id="doctor-section" class="section">
        <div class="container">
            <h2 id="doctor_portal_title">Doctor Portal</h2>
            
            <!-- Doctor Portal Tabs -->
            <div class="patient-tabs" style="border: 2px solid #2E8B57; padding: 10px; margin: 10px 0;">
                <button onclick="showDoctorTab('registration')" class="patient-tab-btn active" id="doctor_tab_registration">📝 Doctor Registration</button>
                <button onclick="showDoctorTab('login')" class="patient-tab-btn" id="doctor_tab_login">🔑 Doctor Login</button>
            </div>
            <p style="color: #2E8B57; font-size: 0.9em; margin: 5px 0;">✅ Doctor Portal now has both Registration and Login tabs above!</p>

            <!-- Doctor Registration Tab -->
            <div id="doctor-registration-tab" class="patient-tab-content active">
                <div class="card">
                    <h3 id="doctor_registration">Doctor Registration</h3>
                    <form id="doctorRegistrationForm">
                        <!-- Basic Information -->
                        <h4 id="doctor_basic_info">📋 Basic Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label id="doctor_full_name">Full Name:</label>
                                <input type="text" id="regDoctorName" required>
                            </div>
                            <div class="form-group">
                                <label id="doctor_phone">Phone Number:</label>
                                <input type="tel" id="regDoctorPhone" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label id="doctor_address">Address:</label>
                                <input type="text" id="regDoctorAddress" required>
                            </div>
                            <div class="form-group">
                                <label id="doctor_password">Password:</label>
                                <input type="password" id="regDoctorPassword" required>
                            </div>
                        </div>

                        <!-- Professional Information -->
                        <div class="medical-info-section">
                            <h4 id="doctor_professional_info">🎓 Professional Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label id="doctor_qualification">Primary Qualification:</label>
                                    <select id="regDoctorQualification" required>
                                        <option value="" id="select_qualification">Select Qualification</option>
                                        <option value="MBBS">MBBS</option>
                                        <option value="MD">MD</option>
                                        <option value="MS">MS</option>
                                        <option value="DM">DM</option>
                                        <option value="MCh">MCh</option>
                                        <option value="BAMS">BAMS</option>
                                        <option value="BHMS">BHMS</option>
                                        <option value="BDS">BDS</option>
                                        <option value="MDS">MDS</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label id="doctor_specialization">Specialization:</label>
                                    <select id="regDoctorSpecialization" required>
                                        <option value="" id="select_specialization">Select Specialization</option>
                                        <option value="General Medicine">General Medicine</option>
                                        <option value="Pediatrics">Pediatrics</option>
                                        <option value="Cardiology">Cardiology</option>
                                        <option value="Dermatology">Dermatology</option>
                                        <option value="Gynecology">Gynecology</option>
                                        <option value="Orthopedics">Orthopedics</option>
                                        <option value="Psychiatry">Psychiatry</option>
                                        <option value="ENT">ENT</option>
                                        <option value="Ophthalmology">Ophthalmology</option>
                                        <option value="Neurology">Neurology</option>
                                        <option value="General Surgery">General Surgery</option>
                                        <option value="Anesthesiology">Anesthesiology</option>
                                        <option value="Radiology">Radiology</option>
                                        <option value="Pathology">Pathology</option>
                                        <option value="Family Medicine">Family Medicine</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label id="doctor_experience">Years of Experience:</label>
                                    <input type="number" id="regDoctorExperience" placeholder="e.g., 5" min="0" max="50">
                                </div>
                                <div class="form-group">
                                    <label id="doctor_license">Medical License Number:</label>
                                    <input type="text" id="regDoctorLicense" placeholder="e.g., MH12345">
                                </div>
                            </div>
                        </div>

                        <!-- Education Background -->
                        <div class="form-group">
                            <label id="doctor_education">Education Background:</label>
                            <textarea id="regDoctorEducation" rows="3" placeholder="Medical college, university, additional certifications, etc."></textarea>
                        </div>
                        
                        <!-- Current Practice -->
                        <div class="form-group">
                            <label id="doctor_current_practice">Current Practice/Hospital:</label>
                            <textarea id="regDoctorPractice" rows="2" placeholder="Current workplace, hospital affiliation, clinic details, etc."></textarea>
                        </div>
                        
                        <button type="submit" class="btn" id="doctor_register_btn">Register as Doctor</button>
                    </form>
                </div>
            </div>

            <!-- Doctor Login Tab -->
            <div id="doctor-login-tab" class="patient-tab-content">
                <div class="card">
                    <h3 id="doctor_login">Doctor Login</h3>
                    <form id="doctorLoginForm">
                        <div class="form-group">
                            <label id="doctor_login_phone">Phone Number:</label>
                            <input type="tel" id="loginDoctorPhone" required>
                        </div>
                        <div class="form-group">
                            <label id="doctor_login_password">Password:</label>
                            <input type="password" id="loginDoctorPassword" required>
                        </div>
                        <button type="submit" class="btn" id="doctor_login_btn">Login</button>
                    </form>
                </div>
                
                <!-- Doctor Profile (shown after login) -->
                <div id="doctorProfile" class="patient-profile" style="display: none;">
                    <h3 id="doctor_profile_title">👨‍⚕️ Doctor Profile</h3>
                    <div class="profile-info">
                        <div class="profile-item">
                            <strong id="doctor_profile_name_label">Name:</strong>
                            <span id="doctorProfileName">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="doctor_profile_phone_label">Phone:</strong>
                            <span id="doctorProfilePhone">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="doctor_profile_address_label">Address:</strong>
                            <span id="doctorProfileAddress">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="doctor_profile_qualification_label">Qualification:</strong>
                            <span id="doctorProfileQualification">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="doctor_profile_specialization_label">Specialization:</strong>
                            <span id="doctorProfileSpecialization">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="doctor_profile_experience_label">Experience:</strong>
                            <span id="doctorProfileExperience">-</span>
                        </div>
                        <div class="profile-item">
                            <strong id="doctor_profile_license_label">License:</strong>
                            <span id="doctorProfileLicense">-</span>
                        </div>
                    </div>
                    
                    <h4 id="doctor_education_title" style="margin: 1.5rem 0 1rem 0; color: #2E8B57;">🎓 Education & Practice</h4>
                    <div style="margin-top: 1rem;">
                        <strong id="doctor_profile_education_label">Education Background:</strong>
                        <p id="doctorProfileEducation" style="margin: 0.5rem 0; padding: 1rem; background: white; border-radius: 4px;">-</p>
                    </div>
                    <div style="margin-top: 1rem;">
                        <strong id="doctor_profile_practice_label">Current Practice:</strong>
                        <p id="doctorProfilePractice" style="margin: 0.5rem 0; padding: 1rem; background: white; border-radius: 4px;">-</p>
                    </div>
                    
                    <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                        <button onclick="viewPendingRequests()" class="btn" id="view_requests_btn">View Patient Requests</button>
                        <button onclick="logoutDoctor()" class="btn" style="background: #6c757d;" id="doctor_logout_btn">Logout</button>
                    </div>
                </div>

                <!-- Pending Requests (shown after login) -->
                <div id="doctorDashboard" class="card" style="display: none; margin-top: 1rem;">
                    <h3 id="pending_requests">Pending Patient Requests</h3>
                    <div id="requestsList">
                        <div class="medicine-result">
                            <h4>Rajesh Kumar (45) - Khera Village</h4>
                            <p><strong>Symptoms:</strong> Fever and cough for 3 days</p>
                            <p><strong>Urgency:</strong> <span style="color: #dc3545;">High</span></p>
                            <p><strong>Time:</strong> 2 hours ago</p>
                            <button class="btn">Start Consultation</button>
                        </div>
                        <div class="medicine-result">
                            <h4>Priya Singh (32) - Dandian Village</h4>
                            <p><strong>Symptoms:</strong> Headache and nausea</p>
                            <p><strong>Urgency:</strong> <span style="color: #ffc107;">Medium</span></p>
                            <p><strong>Time:</strong> 1 hour ago</p>
                            <button class="btn">Start Consultation</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pharmacy Section -->
    <section id="pharmacy-section" class="section">
        <div class="container">
            <h2 id="medicine_availability">Medicine Availability</h2>
            <div class="card">
                <h3 id="search_medicines">Search Medicines</h3>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <input type="text" id="medicineSearch" placeholder="Enter medicine name" style="flex: 1;">
                    <button onclick="searchMedicine()" class="btn" id="search">Search</button>
                </div>
                <div id="medicineResults">
                    <div class="medicine-result">
                        <h4>City Medical Store - Nabha Main Market (0.5 km)</h4>
                        <p><strong>Paracetamol 500mg:</strong> <span style="color: #28a745;">Available</span> - ₹15 (50+ tablets)</p>
                        <p><strong>Contact:</strong> +91 98765-43210</p>
                        <button class="btn">Get Directions</button>
                    </div>
                    <div class="medicine-result">
                        <h4>Health Plus Pharmacy - Khera Village (3.2 km)</h4>
                        <p><strong>Paracetamol 500mg:</strong> <span style="color: #28a745;">Available</span> - ₹12 (100+ tablets)</p>
                        <p><strong>Contact:</strong> +91 98765-43211</p>
                        <button class="btn">Get Directions</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Symptom Checker Section -->
    <section id="symptoms-section" class="section">
        <div class="container">
            <h2 id="symptom_checker_title">🤖 AI Symptom Checker</h2>
            
            <!-- Voice Controls -->
            <div class="voice-controls">
                <button id="startChatBtn" onclick="startSymptomChat()" class="btn">💬 Start Symptom Check</button>
                <button onclick="alert('Voice feature test - this works!')" class="btn" style="background: #17a2b8;">🗺️ Test Button</button>
                <button id="voiceBtn" onclick="toggleVoiceRecording()" class="voice-btn">
                    🎤 <span id="voiceText">Speak Your Symptoms</span>
                </button>
                <button id="speakBtn" onclick="toggleTextToSpeech()" class="voice-btn">
                    🔊 <span id="speakText">AI Voice: ON</span>
                </button>
            </div>
            
            <!-- Chatbot Container -->
            <div class="card">
                <div id="chatbotContainer" class="chatbot-container">
                    <div class="chat-message ai">
                        <div class="message-avatar ai-avatar">🤖</div>
                        <div class="message-bubble ai">
                            Welcome to CSE-D AI Symptom Checker! I'll ask you a few questions to help assess your symptoms. Click "Start Symptom Check" to begin.
                        </div>
                    </div>
                    
                    <!-- Typing Indicator -->
                    <div id="typingIndicator" class="typing-indicator">
                        <div class="message-avatar ai-avatar">🤖</div>
                        AI Doctor is typing
                        <span class="typing-dots">
                            <span>.</span>
                            <span>.</span>
                            <span>.</span>
                        </span>
                    </div>
                </div>
                
                <!-- Chat Options (Dynamic) -->
                <div id="chatOptions" class="chat-options" style="display: none;"></div>
                
                <!-- Diagnosis Results -->
                <div id="diagnosisResult" class="diagnosis-result" style="display: none;"></div>
                
                <!-- Emergency Warning -->
                <div id="emergencyWarning" class="card" style="display: none; background: #fff5f5; border-left: 4px solid #dc3545; margin-top: 1rem;">
                    <h3 style="color: #dc3545;">⚠️ Emergency Alert</h3>
                    <p style="color: #721c24;">Based on your symptoms, this may require immediate medical attention. Please:</p>
                    <div style="margin: 1rem 0;">
                        <button onclick="callEmergency('108')" class="btn emergency-btn">🚑 Call Emergency (108)</button>
                        <button onclick="shareLocation()" class="btn" style="background: #6c757d; margin-left: 1rem;">📍 Share Location</button>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="voice-controls" style="margin-top: 1rem;">
                    <button onclick="restartChat()" class="btn" style="background: #6c757d;">🔄 Start Over</button>
                    <button onclick="bookConsultation()" class="btn">👨‍⚕️ Book Consultation</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Government Schemes Section -->
    <section id="schemes-section" class="section">
        <div class="container">
            <h2 id="govt_schemes_title">🏛️ Government Health Schemes</h2>
            <div class="card">
                <h3>🏥 Ayushman Bharat - PM-JAY</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <span style="background: #28a745; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Active</span>
                    <span style="color: #666; font-size: 0.9rem;">Updated: Today</span>
                </div>
                <p>Free treatment up to ₹5 lakh per family per year</p>
                <div style="margin: 1rem 0;">
                    <p><strong>Eligibility:</strong> Below poverty line families</p>
                    <p><strong>Coverage:</strong> 1,393 medical packages including surgeries, treatments</p>
                    <p><strong>Hospitals:</strong> Civil Hospital Nabha, Patiala Medical College</p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn" onclick="checkEligibility('ayushman')">Check Eligibility</button>
                    <button class="btn" style="background: #6c757d;" onclick="findHospital('ayushman')">Find Hospital</button>
                </div>
            </div>
            
            <div class="card">
                <h3>🏥 Punjab Health Scheme</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <span style="background: #28a745; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Active</span>
                    <span style="color: #666; font-size: 0.9rem;">State Scheme</span>
                </div>
                <p>Free medicines and treatment at all government hospitals in Punjab</p>
                <div style="margin: 1rem 0;">
                    <p><strong>Eligibility:</strong> All Punjab residents</p>
                    <p><strong>Coverage:</strong> Essential medicines, OPD, emergency care</p>
                    <p><strong>Centers:</strong> All PHCs, CHCs, District Hospitals</p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn" onclick="findCenter('punjab')">Find Nearby Center</button>
                    <button class="btn" style="background: #6c757d;" onclick="downloadCard('punjab')">Get Health Card</button>
                </div>
            </div>
            
            <div class="card">
                <h3>💊 Jan Aushadhi Scheme</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <span style="background: #28a745; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Active</span>
                    <span style="color: #666; font-size: 0.9rem;">Central Scheme</span>
                </div>
                <p>Generic medicines at 50-90% lower prices than branded medicines</p>
                <div style="margin: 1rem 0;">
                    <p><strong>Eligibility:</strong> Everyone can purchase</p>
                    <p><strong>Medicines:</strong> 1,500+ generic medicines available</p>
                    <p><strong>Stores:</strong> Nabha Main Market, Civil Hospital premises</p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn" onclick="findStore('janaushadhi')">Find Store</button>
                    <button class="btn" style="background: #6c757d;" onclick="comparePrices()">Compare Prices</button>
                </div>
            </div>
            
            <div class="card">
                <h3>🚑 Emergency Medical Scheme</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <span style="background: #dc3545; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">24/7 Active</span>
                    <span style="color: #666; font-size: 0.9rem;">Emergency Only</span>
                </div>
                <p>Free ambulance service and emergency treatment for all</p>
                <div style="margin: 1rem 0;">
                    <p><strong>Service:</strong> 108 Ambulance with trained paramedics</p>
                    <p><strong>Coverage:</strong> Free emergency care at government hospitals</p>
                    <p><strong>Response:</strong> Average 15 minutes in rural areas</p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn emergency-btn" onclick="callEmergency('108')">🚑 Call 108</button>
                    <button class="btn" style="background: #6c757d;" onclick="trackAmbulance()">Track Ambulance</button>
                </div>
            </div>
            
            <div class="card" style="background: #e8f4f8; border-left: 4px solid #17a2b8;">
                <h3>📞 Need Help with Schemes?</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div>
                        <strong>📞 Ayushman Bharat Helpline:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">14555</span> (Toll Free)
                    </div>
                    <div>
                        <strong>🏥 Civil Hospital Nabha:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">01762-230345</span>
                    </div>
                    <div>
                        <strong>🏛️ District Health Office:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">0175-2212345</span> (Patiala)
                    </div>
                    <div>
                        <strong>💊 Jan Aushadhi Info:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">1800-180-5050</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Emergency Section -->
    <section id="emergency-section" class="section">
        <div class="container">
            <h2 style="color: #dc3545;">🚨 Emergency Services</h2>
            
            <div class="card" style="background: #fff5f5; border-left: 4px solid #dc3545;">
                <h3 style="color: #dc3545;">⚠️ Emergency Warning Signs</h3>
                <p style="color: #721c24;"><strong>Call Emergency Services Immediately If You Have:</strong></p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 0.5rem; margin: 1rem 0;">
                    <div>• Severe chest pain or pressure</div>
                    <div>• Severe difficulty breathing</div>
                    <div>• Loss of consciousness or confusion</div>
                    <div>• Severe bleeding that won't stop</div>
                    <div>• Serious head injury</div>
                    <div>• High fever with confusion</div>
                    <div>• Signs of stroke (facial drooping, arm weakness)</div>
                    <div>• Severe allergic reaction</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div class="card">
                    <h3>🚑 Medical Emergency</h3>
                    <p>Free 24/7 ambulance service with trained paramedics and medical equipment</p>
                    <div style="margin: 1rem 0; color: #666; font-size: 0.9rem;">
                        <div>• Average response time: 15 minutes</div>
                        <div>• GPS-enabled ambulances</div>
                        <div>• Free service for all</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="callEmergency('108')" class="btn emergency-btn">📞 Call 108</button>
                        <button onclick="shareLocation()" class="btn" style="background: #6c757d;">📍 Share Location</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>🚓 Police Emergency</h3>
                    <p>Police emergency response for crime, accidents, and law enforcement</p>
                    <div style="margin: 1rem 0; color: #666; font-size: 0.9rem;">
                        <div>• Crime reporting</div>
                        <div>• Accident assistance</div>
                        <div>• Women safety helpline</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="callEmergency('100')" class="btn emergency-btn">📞 Call 100</button>
                        <button onclick="callEmergency('1091')" class="btn" style="background: #e91e63;">👩 Women Helpline</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>🚒 Fire Emergency</h3>
                    <p>Fire department emergency response for fires and rescue operations</p>
                    <div style="margin: 1rem 0; color: #666; font-size: 0.9rem;">
                        <div>• Fire suppression</div>
                        <div>• Rescue operations</div>
                        <div>• Hazardous material response</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="callEmergency('101')" class="btn emergency-btn">📞 Call 101</button>
                        <button onclick="reportFire()" class="btn" style="background: #6c757d;">🔥 Report Fire</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>🏭 Disaster Management</h3>
                    <p>Natural disaster response and emergency coordination</p>
                    <div style="margin: 1rem 0; color: #666; font-size: 0.9rem;">
                        <div>• Flood response</div>
                        <div>• Earthquake assistance</div>
                        <div>• Emergency shelter</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="callEmergency('1070')" class="btn emergency-btn">📞 Call 1070</button>
                        <button onclick="findShelter()" class="btn" style="background: #6c757d;">🏠 Find Shelter</button>
                    </div>
                </div>
            </div>
            
            <div class="card" style="background: #e8f4f8; border-left: 4px solid #17a2b8;">
                <h3>📞 Important Local Contacts</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div>
                        <strong>🏥 Civil Hospital Nabha:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">01762-230345</span>
                    </div>
                    <div>
                        <strong>🚓 Police Station Nabha:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">01762-230100</span>
                    </div>
                    <div>
                        <strong>🚒 Fire Station:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">01762-230101</span>
                    </div>
                    <div>
                        <strong>🏥 District Hospital Patiala:</strong><br>
                        <span style="color: #17a2b8; font-weight: bold;">0175-2212345</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>📍 Your Location</h3>
                <div id="locationDisplay" style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
                    <p style="margin: 0; color: #666;">Click "Get My Location" to share your current location with emergency services</p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button onclick="getCurrentLocation()" class="btn">📍 Get My Location</button>
                    <button onclick="sendLocationSMS()" class="btn" style="background: #6c757d;">📱 Send Location SMS</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Status Messages -->
    <div id="statusMessage" class="status-message"></div>

    <script>
        // Translation data
        const translations = {
            en: {
                app_title: "CSE-D Telemedicine",
                patient_portal: "Patient Portal",
                patient_portal_title: "Patient Portal",
                doctor_portal: "Doctor Portal",
                pharmacy_portal: "Pharmacy Portal",
                symptom_checker: "Symptom Checker",
                emergency: "🚨 Emergency",
                tab_registration: "Registration",
                tab_login: "Login",
                patient_registration: "Patient Registration",
                patient_login: "Patient Login",
                basic_info: "📋 Basic Information",
                medical_info: "🩺 Medical Information",
                full_name: "Full Name:",
                village: "Village/Address:",
                phone: "Phone Number:",
                age: "Age:",
                gender: "Gender:",
                select_gender: "Select Gender",
                male: "Male",
                female: "Female",
                other: "Other",
                password: "Password:",
                blood_group: "Blood Group:",
                select_blood_group: "Select Blood Group",
                height: "Height (cm):",
                weight: "Weight (kg):",
                sugar_level: "Sugar Level (mg/dL):",
                blood_pressure_systolic: "Blood Pressure (Systolic):",
                blood_pressure_diastolic: "Blood Pressure (Diastolic):",
                medical_history: "Medical History:",
                current_symptoms: "Current Symptoms:",
                symptoms: "Describe your symptoms:",
                urgency: "Urgency Level:",
                low: "Low",
                medium: "Medium",
                high: "High",
                emergency_level: "Emergency",
                register_btn: "Register & Submit Request",
                login_phone: "Phone Number:",
                login_password: "Password:",
                login_btn: "Login",
                patient_profile_title: "👤 Patient Profile",
                profile_name_label: "Name:",
                profile_age_label: "Age:",
                profile_gender_label: "Gender:",
                profile_phone_label: "Phone:",
                profile_blood_group_label: "Blood Group:",
                profile_village_label: "Address:",
                medical_info_title: "🩺 Medical Information",
                profile_height_label: "Height:",
                profile_weight_label: "Weight:",
                profile_sugar_label: "Sugar Level:",
                profile_bp_label: "Blood Pressure:",
                profile_history_label: "Medical History:",
                request_consultation_btn: "Request New Consultation",
                logout_btn: "Logout",
                submit_request: "Submit Request",
                doctor_dashboard: "Doctor Dashboard",
                pending_requests: "Pending Patient Requests",
                medicine_availability: "Medicine Availability",
                search_medicines: "Search Medicines",
                search: "Search",
                symptom_checker_title: "AI Symptom Checker"
            },
            hi: {
                app_title: "CSE-D टेलीमेडिसिन",
                patient_portal: "मरीज़ पोर्टल",
                doctor_portal: "डॉक्टर पोर्टल",
                pharmacy_portal: "दवाखाना पोर्टल",
                symptom_checker: "लक्षण जांचकर्ता",
                emergency: "🚨 आपातकाल",
                patient_registration: "मरीज़ पंजीकरण",
                full_name: "पूरा नाम:",
                village: "गांव:",
                phone: "फ़ोन नंबर:",
                age: "उम्र:",
                symptoms: "अपने लक्षणों का वर्णन करें:",
                urgency: "तात्कालिकता स्तर:",
                low: "कम",
                medium: "मध्यम",
                high: "उच्च",
                emergency_level: "आपातकाल",
                submit_request: "अनुरोध भेजें",
                doctor_dashboard: "डॉक्टर डैशबोर्ड",
                pending_requests: "लंबित मरीज़ अनुरोध",
                medicine_availability: "दवा उपलब्धता",
                search_medicines: "दवाएं खोजें",
                search: "खोजें",
                symptom_checker_title: "AI लक्षण जांचकर्ता"
            },
            te: {
                app_title: "CSE-D టెలిమెడిసిన్",
                patient_portal: "రోగి పోర్టల్",
                doctor_portal: "డాక్టర్ పోర్టల్",
                pharmacy_portal: "మరున్ను పోర్టల్",
                symptom_checker: "లక్షణాల పరీక్షకుడు",
                emergency: "🚨 ఎమర్జెన్సీ",
                patient_registration: "రోగి నమోదు",
                full_name: "పూర్ణ పేరు:",
                village: "గ్రామం/కిరానా:",
                phone: "ఫోన్ నంబర్:",
                age: "వయస్సు:",
                symptoms: "మీ లక్షణాలన్ని వివరించండి:",
                urgency: "క్షిప్రతా స్థాయి:",
                low: "తక్కువ",
                medium: "మధ్యమం",
                high: "ఎక్కువ",
                emergency_level: "ఎమర్జెన్సీ",
                submit_request: "అర్జి పంపండి",
                doctor_dashboard: "డాక్టర్ డాష్‌బోర్డ్",
                pending_requests: "పెండింగ్ రోగి అర్జిలు",
                medicine_availability: "మరున్ను లభ్యత",
                search_medicines: "మరున్నులను తెలుసుకోండి",
                search: "తెలుసుకో",
                symptom_checker_title: "AI లక్షణాల పరీక్షకుడు"
            }
        };

        let currentLanguage = 'en';
        let selectedSymptoms = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            showSection('patient');
        });

        // Setup event listeners
        function setupEventListeners() {
            // Language selector
            document.getElementById('languageSelect').addEventListener('change', function(e) {
                changeLanguage(e.target.value);
            });

            // Patient registration form
            const regForm = document.getElementById('patientRegistrationForm');
            if (regForm) {
                regForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    registerPatient();
                });
            }

            // Patient login form
            const loginForm = document.getElementById('patientLoginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    loginPatient();
                });
            }

            // Doctor registration form
            const doctorRegForm = document.getElementById('doctorRegistrationForm');
            if (doctorRegForm) {
                doctorRegForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    registerDoctor();
                });
            }

            // Doctor login form
            const doctorLoginForm = document.getElementById('doctorLoginForm');
            if (doctorLoginForm) {
                doctorLoginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    loginDoctor();
                });
            }
        }

        // Patient Portal Functions
        function showPatientTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.patient-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.patient-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            console.log('Switched to patient tab:', tabName);
        }

        function registerPatient() {
            const formData = {
                name: document.getElementById('regPatientName').value,
                age: document.getElementById('regPatientAge').value,
                phone: document.getElementById('regPatientPhone').value,
                gender: document.getElementById('regPatientGender').value,
                village: document.getElementById('regPatientVillage').value,
                password: document.getElementById('regPatientPassword').value,
                bloodGroup: document.getElementById('regBloodGroup').value,
                height: document.getElementById('regHeight').value,
                weight: document.getElementById('regWeight').value,
                sugarLevel: document.getElementById('regSugarLevel').value,
                bpSystolic: document.getElementById('regBPSystolic').value,
                bpDiastolic: document.getElementById('regBPDiastolic').value,
                medicalHistory: document.getElementById('regMedicalHistory').value,
                currentSymptoms: document.getElementById('regCurrentSymptoms').value,
                urgency: document.getElementById('regUrgencyLevel').value,
                registrationDate: new Date().toISOString()
            };

            // Save patient data to localStorage
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            
            // Check if patient already exists
            const existingPatient = patients.find(p => p.phone === formData.phone);
            if (existingPatient) {
                showStatusMessage('Patient with this phone number already exists!', 'error');
                return;
            }

            patients.push(formData);
            localStorage.setItem('patients', JSON.stringify(patients));
            
            // Also save the consultation request
            const requests = JSON.parse(localStorage.getItem('consultationRequests') || '[]');
            requests.push({
                ...formData,
                id: 'REQ-' + Date.now(),
                timestamp: new Date().toISOString(),
                status: 'pending'
            });
            localStorage.setItem('consultationRequests', JSON.stringify(requests));

            showStatusMessage('Registration successful! Consultation request submitted.', 'success');
            document.getElementById('patientRegistrationForm').reset();
            
            // Switch to login tab
            setTimeout(() => {
                showPatientTab('login');
            }, 2000);
        }

        function loginPatient() {
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;

            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patient = patients.find(p => p.phone === phone && p.password === password);

            if (patient) {
                displayPatientProfile(patient);
                showStatusMessage('Login successful!', 'success');
                document.getElementById('patientLoginForm').reset();
            } else {
                showStatusMessage('Invalid phone number or password!', 'error');
            }
        }

        function displayPatientProfile(patient) {
            document.getElementById('profileName').textContent = patient.name;
            document.getElementById('profileAge').textContent = patient.age + ' years';
            document.getElementById('profileGender').textContent = patient.gender;
            document.getElementById('profilePhone').textContent = patient.phone;
            document.getElementById('profileBloodGroup').textContent = patient.bloodGroup || '-';
            document.getElementById('profileVillage').textContent = patient.village;
            
            document.getElementById('profileHeight').textContent = patient.height ? patient.height + ' cm' : '-';
            document.getElementById('profileWeight').textContent = patient.weight ? patient.weight + ' kg' : '-';
            document.getElementById('profileSugar').textContent = patient.sugarLevel ? patient.sugarLevel + ' mg/dL' : '-';
            
            const bp = patient.bpSystolic && patient.bpDiastolic ? 
                `${patient.bpSystolic}/${patient.bpDiastolic} mmHg` : '-';
            document.getElementById('profileBP').textContent = bp;
            
            document.getElementById('profileMedicalHistory').textContent = patient.medicalHistory || 'No medical history recorded.';

            document.getElementById('patientProfile').style.display = 'block';
            document.getElementById('patientLoginForm').parentElement.style.display = 'none';
        }

        function requestConsultation() {
            // This would typically open a form for new consultation request
            alert('New consultation request feature coming soon!');
        }

        function logoutPatient() {
            document.getElementById('patientProfile').style.display = 'none';
            document.getElementById('patientLoginForm').parentElement.style.display = 'block';
            showStatusMessage('Logged out successfully!', 'success');
        }

        // Doctor Portal Functions
        function showDoctorTab(tabName) {
            // Hide all doctor tab contents
            document.querySelectorAll('.patient-tab-content').forEach(tab => {
                if (tab.id.includes('doctor')) {
                    tab.classList.remove('active');
                }
            });

            // Remove active class from doctor tab buttons
            document.querySelectorAll('#doctor_tab_registration, #doctor_tab_login').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected doctor tab
            document.getElementById('doctor-' + tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            console.log('Switched to doctor tab:', tabName);
        }

        function registerDoctor() {
            const formData = {
                name: document.getElementById('regDoctorName').value,
                phone: document.getElementById('regDoctorPhone').value,
                address: document.getElementById('regDoctorAddress').value,
                password: document.getElementById('regDoctorPassword').value,
                qualification: document.getElementById('regDoctorQualification').value,
                specialization: document.getElementById('regDoctorSpecialization').value,
                experience: document.getElementById('regDoctorExperience').value,
                license: document.getElementById('regDoctorLicense').value,
                education: document.getElementById('regDoctorEducation').value,
                practice: document.getElementById('regDoctorPractice').value,
                registrationDate: new Date().toISOString()
            };

            // Save doctor data to localStorage
            const doctors = JSON.parse(localStorage.getItem('doctors') || '[]');
            
            // Check if doctor already exists
            const existingDoctor = doctors.find(d => d.phone === formData.phone);
            if (existingDoctor) {
                showStatusMessage('Doctor with this phone number already exists!', 'error');
                return;
            }

            doctors.push(formData);
            localStorage.setItem('doctors', JSON.stringify(doctors));

            showStatusMessage('Doctor registration successful!', 'success');
            document.getElementById('doctorRegistrationForm').reset();
            
            // Switch to login tab
            setTimeout(() => {
                showDoctorTab('login');
            }, 2000);
        }

        function loginDoctor() {
            const phone = document.getElementById('loginDoctorPhone').value;
            const password = document.getElementById('loginDoctorPassword').value;

            const doctors = JSON.parse(localStorage.getItem('doctors') || '[]');
            const doctor = doctors.find(d => d.phone === phone && d.password === password);

            if (doctor) {
                displayDoctorProfile(doctor);
                showStatusMessage('Doctor login successful!', 'success');
                document.getElementById('doctorLoginForm').reset();
            } else {
                showStatusMessage('Invalid phone number or password!', 'error');
            }
        }

        function displayDoctorProfile(doctor) {
            document.getElementById('doctorProfileName').textContent = doctor.name;
            document.getElementById('doctorProfilePhone').textContent = doctor.phone;
            document.getElementById('doctorProfileAddress').textContent = doctor.address;
            document.getElementById('doctorProfileQualification').textContent = doctor.qualification || '-';
            document.getElementById('doctorProfileSpecialization').textContent = doctor.specialization || '-';
            document.getElementById('doctorProfileExperience').textContent = doctor.experience ? doctor.experience + ' years' : '-';
            document.getElementById('doctorProfileLicense').textContent = doctor.license || '-';
            
            document.getElementById('doctorProfileEducation').textContent = doctor.education || 'No education background recorded.';
            document.getElementById('doctorProfilePractice').textContent = doctor.practice || 'No current practice information recorded.';

            document.getElementById('doctorProfile').style.display = 'block';
            document.getElementById('doctorLoginForm').parentElement.style.display = 'none';
        }

        function viewPendingRequests() {
            document.getElementById('doctorDashboard').style.display = 'block';
            showStatusMessage('Showing patient requests...', 'success');
        }

        function logoutDoctor() {
            document.getElementById('doctorProfile').style.display = 'none';
            document.getElementById('doctorDashboard').style.display = 'none';
            document.getElementById('doctorLoginForm').parentElement.style.display = 'block';
            showStatusMessage('Doctor logged out successfully!', 'success');
        }

        // Show section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-links button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            console.log('Switched to section:', sectionName);
        }

        // Change language
        function changeLanguage(lang) {
            currentLanguage = lang;
            
            // Update all translatable elements
            Object.keys(translations[lang]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' && element.type === 'submit') {
                        element.value = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            console.log('Language changed to:', lang);
        }

        // AI Symptom Checker Variables
        let currentQuestion = 0;
        let chatActive = false;
        let userResponses = {};
        let voiceRecognition = null;
        let speechSynthesis = window.speechSynthesis;
        let aiVoiceEnabled = true;
        let isRecording = false;

        // Comprehensive Symptom Assessment Questions
        const symptomQuestions = [
            {
                id: 'main_symptom_category',
                question: "Which body system or area is your main concern?",
                options: [
                    { text: "🫁 Respiratory (Breathing, Cough, Chest)", value: "respiratory" },
                    { text: "❤️ Cardiovascular (Heart, Chest Pain)", value: "cardiovascular" },
                    { text: "🧠 Neurological (Head, Brain, Nerves)", value: "neurological" },
                    { text: "🍽️ Digestive (Stomach, Intestines)", value: "digestive" },
                    { text: "🦴 Musculoskeletal (Bones, Joints, Muscles)", value: "musculoskeletal" },
                    { text: "🌡️ General (Fever, Fatigue, Weight)", value: "general" },
                    { text: "👁️ Eyes/Vision Problems", value: "vision" },
                    { text: "👂 Ear/Hearing Issues", value: "hearing" },
                    { text: "🩸 Skin Conditions", value: "skin" },
                    { text: "🧠 Mental Health", value: "mental" },
                    { text: "👶 Women's Health/Reproductive", value: "reproductive" },
                    { text: "💊 Kidney/Urinary Issues", value: "urinary" }
                ]
            },
            {
                id: 'specific_symptom',
                question: "What is your specific main symptom?",
                options: [
                    // Respiratory
                    { text: "🫁 Dry Cough", value: "dry_cough", category: "respiratory" },
                    { text: "🫁 Cough with Phlegm", value: "wet_cough", category: "respiratory" },
                    { text: "🫁 Shortness of Breath", value: "shortness_breath", category: "respiratory" },
                    { text: "🫁 Wheezing", value: "wheezing", category: "respiratory" },
                    { text: "🫁 Chest Tightness", value: "chest_tightness", category: "respiratory" },
                    { text: "🫁 Sore Throat", value: "sore_throat", category: "respiratory" },
                    { text: "🫁 Runny/Stuffy Nose", value: "nasal_congestion", category: "respiratory" },
                    
                    // Cardiovascular
                    { text: "❤️ Chest Pain/Pressure", value: "chest_pain", category: "cardiovascular" },
                    { text: "❤️ Heart Palpitations", value: "palpitations", category: "cardiovascular" },
                    { text: "❤️ Irregular Heartbeat", value: "irregular_heartbeat", category: "cardiovascular" },
                    { text: "❤️ Swelling in Legs/Ankles", value: "leg_swelling", category: "cardiovascular" },
                    
                    // Neurological
                    { text: "🧠 Severe Headache", value: "severe_headache", category: "neurological" },
                    { text: "🧠 Migraine", value: "migraine", category: "neurological" },
                    { text: "🧠 Dizziness/Vertigo", value: "dizziness", category: "neurological" },
                    { text: "🧠 Confusion/Memory Issues", value: "confusion", category: "neurological" },
                    { text: "🧠 Seizures", value: "seizures", category: "neurological" },
                    { text: "🧠 Numbness/Tingling", value: "numbness", category: "neurological" },
                    { text: "🧠 Balance Problems", value: "balance_issues", category: "neurological" },
                    
                    // Digestive
                    { text: "🍽️ Severe Stomach Pain", value: "stomach_pain", category: "digestive" },
                    { text: "🍽️ Nausea/Vomiting", value: "nausea_vomiting", category: "digestive" },
                    { text: "🍽️ Diarrhea", value: "diarrhea", category: "digestive" },
                    { text: "🍽️ Constipation", value: "constipation", category: "digestive" },
                    { text: "🍽️ Acid Reflux/Heartburn", value: "acid_reflux", category: "digestive" },
                    { text: "🍽️ Loss of Appetite", value: "appetite_loss", category: "digestive" },
                    { text: "🍽️ Blood in Stool", value: "blood_stool", category: "digestive" },
                    
                    // Musculoskeletal
                    { text: "🦴 Back Pain", value: "back_pain", category: "musculoskeletal" },
                    { text: "🦴 Joint Pain", value: "joint_pain", category: "musculoskeletal" },
                    { text: "🦴 Muscle Cramps", value: "muscle_cramps", category: "musculoskeletal" },
                    { text: "🦴 Neck Pain", value: "neck_pain", category: "musculoskeletal" },
                    { text: "🦴 Shoulder Pain", value: "shoulder_pain", category: "musculoskeletal" },
                    { text: "🦴 Hip/Knee Pain", value: "hip_knee_pain", category: "musculoskeletal" },
                    
                    // General
                    { text: "🌡️ High Fever (>101°F)", value: "high_fever", category: "general" },
                    { text: "🌡️ Low Grade Fever", value: "low_fever", category: "general" },
                    { text: "🌡️ Extreme Fatigue", value: "extreme_fatigue", category: "general" },
                    { text: "🌡️ Unexplained Weight Loss", value: "weight_loss", category: "general" },
                    { text: "🌡️ Unexplained Weight Gain", value: "weight_gain", category: "general" },
                    { text: "🌡️ Night Sweats", value: "night_sweats", category: "general" },
                    
                    // Vision
                    { text: "👁️ Blurred Vision", value: "blurred_vision", category: "vision" },
                    { text: "👁️ Eye Pain", value: "eye_pain", category: "vision" },
                    { text: "👁️ Double Vision", value: "double_vision", category: "vision" },
                    { text: "👁️ Light Sensitivity", value: "light_sensitivity", category: "vision" },
                    
                    // Hearing
                    { text: "👂 Ear Pain", value: "ear_pain", category: "hearing" },
                    { text: "👂 Hearing Loss", value: "hearing_loss", category: "hearing" },
                    { text: "👂 Ringing in Ears", value: "tinnitus", category: "hearing" },
                    { text: "👂 Ear Discharge", value: "ear_discharge", category: "hearing" },
                    
                    // Skin
                    { text: "🩸 Rash/Skin Irritation", value: "rash", category: "skin" },
                    { text: "🩸 Itching", value: "itching", category: "skin" },
                    { text: "🩸 Unusual Moles/Growths", value: "skin_growths", category: "skin" },
                    { text: "🩸 Wounds Not Healing", value: "non_healing_wounds", category: "skin" },
                    
                    // Mental Health
                    { text: "🧠 Persistent Sadness", value: "depression", category: "mental" },
                    { text: "🧠 Anxiety/Panic Attacks", value: "anxiety", category: "mental" },
                    { text: "🧠 Sleep Problems", value: "sleep_issues", category: "mental" },
                    { text: "🧠 Mood Swings", value: "mood_swings", category: "mental" },
                    
                    // Reproductive
                    { text: "👶 Menstrual Irregularities", value: "menstrual_issues", category: "reproductive" },
                    { text: "👶 Pelvic Pain", value: "pelvic_pain", category: "reproductive" },
                    { text: "👶 Pregnancy Concerns", value: "pregnancy_concerns", category: "reproductive" },
                    
                    // Urinary
                    { text: "💊 Painful Urination", value: "painful_urination", category: "urinary" },
                    { text: "💊 Frequent Urination", value: "frequent_urination", category: "urinary" },
                    { text: "💊 Blood in Urine", value: "blood_urine", category: "urinary" },
                    { text: "💊 Kidney Pain", value: "kidney_pain", category: "urinary" }
                ]
            },
            {
                id: 'severity',
                question: "How would you rate the severity of your symptoms?",
                options: [
                    { text: "😊 Mild (1-3) - Manageable discomfort", value: "mild" },
                    { text: "😐 Moderate (4-6) - Noticeable impact on daily life", value: "moderate" },
                    { text: "😰 Severe (7-8) - Significant pain/discomfort", value: "severe" },
                    { text: "🚨 Critical (9-10) - Unbearable, need immediate help", value: "critical" }
                ]
            },
            {
                id: 'duration',
                question: "How long have you been experiencing these symptoms?",
                options: [
                    { text: "⏰ Less than 6 hours", value: "less_6hours" },
                    { text: "📅 6-24 hours", value: "6_24hours" },
                    { text: "📅 1-3 days", value: "1_3days" },
                    { text: "📅 4-7 days", value: "4_7days" },
                    { text: "📅 1-2 weeks", value: "1_2weeks" },
                    { text: "📅 2-4 weeks", value: "2_4weeks" },
                    { text: "📅 More than 1 month", value: "more_1month" }
                ]
            },
            {
                id: 'additional_symptoms',
                question: "Do you have any of these additional symptoms? (Select all that apply)",
                options: [
                    { text: "🤢 Nausea/Vomiting", value: "nausea" },
                    { text: "💫 Dizziness/Lightheadedness", value: "dizziness" },
                    { text: "😴 Extreme Fatigue/Weakness", value: "fatigue" },
                    { text: "🌡️ Fever/Chills", value: "fever_chills" },
                    { text: "😰 Shortness of Breath", value: "breathlessness" },
                    { text: "💧 Excessive Sweating", value: "sweating" },
                    { text: "🍽️ Loss of Appetite", value: "appetite_loss" },
                    { text: "😵 Confusion/Disorientation", value: "confusion" },
                    { text: "🦵 Swelling in Extremities", value: "swelling" },
                    { text: "✋ None of the above", value: "none" }
                ]
            },
            {
                id: 'medical_history',
                question: "Do you have any existing medical conditions?",
                options: [
                    { text: "🩸 Diabetes (Type 1 or 2)", value: "diabetes" },
                    { text: "💗 High Blood Pressure/Hypertension", value: "hypertension" },
                    { text: "❤️ Heart Disease/Heart Problems", value: "heart_disease" },
                    { text: "🫁 Asthma/COPD/Respiratory Issues", value: "respiratory_disease" },
                    { text: "🧠 Neurological Conditions", value: "neurological_disease" },
                    { text: "🦴 Arthritis/Joint Problems", value: "arthritis" },
                    { text: "🩸 Blood Disorders", value: "blood_disorders" },
                    { text: "🍽️ Digestive/GI Problems", value: "digestive_disease" },
                    { text: "🧬 Cancer (Current or Past)", value: "cancer" },
                    { text: "💊 Kidney/Liver Disease", value: "kidney_liver" },
                    { text: "🧠 Mental Health Conditions", value: "mental_health" },
                    { text: "💉 Autoimmune Conditions", value: "autoimmune" },
                    { text: "✋ No existing conditions", value: "none" }
                ]
            },
            {
                id: 'recent_factors',
                question: "Have you experienced any of these recently?",
                options: [
                    { text: "✈️ Recent Travel (Domestic/International)", value: "travel" },
                    { text: "🍽️ Change in Diet/New Foods", value: "diet_change" },
                    { text: "😰 High Stress/Emotional Trauma", value: "high_stress" },
                    { text: "🤧 Contact with Sick Person", value: "contact_sick" },
                    { text: "💊 Started New Medications", value: "new_medications" },
                    { text: "🏥 Recent Surgery/Medical Procedure", value: "recent_surgery" },
                    { text: "🏃 Increased Physical Activity", value: "increased_activity" },
                    { text: "📱 Changes in Sleep Pattern", value: "sleep_changes" },
                    { text: "🌿 Exposure to Allergens/Chemicals", value: "allergen_exposure" },
                    { text: "✋ None of the above", value: "none" }
                ]
            }
        ];

        // Start Symptom Chat
        function startSymptomChat() {
            console.log('startSymptomChat called'); // Debug log
            
            try {
                currentQuestion = 0;
                chatActive = true;
                userResponses = {};
                
                // Clear previous chat
                const container = document.getElementById('chatbotContainer');
                if (!container) {
                    console.error('chatbotContainer not found');
                    return;
                }
                
                container.innerHTML = `
                    <div class="chat-message ai">
                        <div class="message-avatar ai-avatar">🤖</div>
                        <div class="message-bubble ai">
                            Hi! I'm your AI health assistant. I'll ask you 6 questions to better understand your symptoms and provide guidance.
                        </div>
                    </div>
                `;
                
                // Hide results and start first question
                const diagnosisDiv = document.getElementById('diagnosisResult');
                const emergencyDiv = document.getElementById('emergencyWarning');
                
                if (diagnosisDiv) diagnosisDiv.style.display = 'none';
                if (emergencyDiv) emergencyDiv.style.display = 'none';
                
                showStatusMessage('Starting symptom assessment...', 'success');
                
                setTimeout(() => {
                    askQuestion(0);
                }, 1000);
                
            } catch (error) {
                console.error('Error in startSymptomChat:', error);
                showStatusMessage('Error starting symptom checker: ' + error.message, 'error');
            }
        }
        
        // Make function globally accessible
        window.startSymptomChat = startSymptomChat;

        // Ask Question
        function askQuestion(questionIndex) {
            if (questionIndex >= symptomQuestions.length) {
                analyzeSymptomsAndProvideResults();
                return;
            }

            const question = symptomQuestions[questionIndex];
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                // Add AI question
                addChatMessage('ai', `Question ${questionIndex + 1}/6: ${question.question}`);
                
                // Speak question if voice is enabled
                if (aiVoiceEnabled) {
                    speakText(question.question);
                }
                
                // Show options
                showQuestionOptions(question.options, questionIndex);
            }, 1500);
        }

        // Show Question Options
        function showQuestionOptions(options, questionIndex) {
            const optionsDiv = document.getElementById('chatOptions');
            optionsDiv.innerHTML = '';
            
            options.forEach(option => {
                const btn = document.createElement('div');
                btn.className = 'chat-option';
                btn.textContent = option.text;
                btn.onclick = () => selectOption(option, questionIndex);
                optionsDiv.appendChild(btn);
            });
            
            optionsDiv.style.display = 'flex';
        }

        // Select Option
        function selectOption(option, questionIndex) {
            const question = symptomQuestions[questionIndex];
            userResponses[question.id] = option.value;
            
            // Add user response to chat
            addChatMessage('user', option.text);
            
            // Hide options
            document.getElementById('chatOptions').style.display = 'none';
            
            // Move to next question
            currentQuestion = questionIndex + 1;
            setTimeout(() => {
                askQuestion(currentQuestion);
            }, 500);
        }

        // Add Chat Message
        function addChatMessage(sender, message) {
            const container = document.getElementById('chatbotContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const avatar = sender === 'ai' ? '🤖' : '👤';
            const avatarClass = sender === 'ai' ? 'ai-avatar' : 'user-avatar';
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${avatarClass}">${avatar}</div>
                <div class="message-bubble ${sender}">${message}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Show/Hide Typing Indicator
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const container = document.getElementById('chatbotContainer');
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // Analyze Symptoms and Provide Results
        function analyzeSymptomsAndProvideResults() {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const assessment = calculateSymptomAssessment(userResponses);
                
                addChatMessage('ai', 'Thank you for answering all my questions. Let me analyze your symptoms...');
                
                setTimeout(() => {
                    displayDiagnosis(assessment);
                }, 2000);
            }, 1500);
        }

        // Comprehensive Medical Knowledge Database
        const medicalKnowledge = {
            // Respiratory conditions
            dry_cough: {
                condition: "Dry Cough",
                possibleCauses: ["Viral infection", "Allergies", "Asthma", "GERD", "Medication side effects"],
                doctorType: "General Practitioner or Pulmonologist",
                urgencyFactors: ["fever", "shortness_breath", "blood_cough"],
                dietRecommendations: ["Warm water with honey", "Ginger tea", "Avoid cold drinks", "Stay hydrated"],
                careInstructions: ["Use humidifier", "Avoid irritants like smoke", "Rest your voice", "Sleep with elevated head"]
            },
            wet_cough: {
                condition: "Productive Cough",
                possibleCauses: ["Bacterial infection", "Pneumonia", "Bronchitis", "COPD exacerbation"],
                doctorType: "General Practitioner or Pulmonologist",
                urgencyFactors: ["green_yellow_sputum", "fever", "chest_pain"],
                dietRecommendations: ["Warm fluids", "Spicy foods to thin mucus", "Avoid dairy temporarily"],
                careInstructions: ["Expectorate mucus", "Steam inhalation", "Chest physiotherapy", "Monitor sputum color"]
            },
            shortness_breath: {
                condition: "Shortness of Breath",
                possibleCauses: ["Asthma", "Heart problems", "Anemia", "Anxiety", "Lung infection"],
                doctorType: "Cardiologist or Pulmonologist (Emergency if severe)",
                urgencyFactors: ["chest_pain", "blue_lips", "severe"],
                dietRecommendations: ["Light meals", "Iron-rich foods if anemic", "Avoid gas-producing foods"],
                careInstructions: ["Sit upright", "Practice breathing exercises", "Avoid strenuous activity", "Use prescribed inhalers"]
            },
            chest_pain: {
                condition: "Chest Pain",
                possibleCauses: ["Heart attack", "Angina", "Muscle strain", "Anxiety", "GERD"],
                doctorType: "Cardiologist (Emergency if severe)",
                urgencyFactors: ["radiating_pain", "sweating", "nausea", "severe"],
                dietRecommendations: ["Low sodium", "Heart-healthy foods", "Avoid caffeine", "Light meals"],
                careInstructions: ["Rest immediately", "Take prescribed nitroglycerin if available", "Avoid physical activity", "Call emergency if severe"]
            },
            severe_headache: {
                condition: "Severe Headache",
                possibleCauses: ["Migraine", "Tension headache", "High blood pressure", "Meningitis", "Brain tumor"],
                doctorType: "Neurologist or General Practitioner",
                urgencyFactors: ["neck_stiffness", "fever", "vision_changes", "confusion"],
                dietRecommendations: ["Stay hydrated", "Avoid trigger foods", "Regular meals", "Limit caffeine"],
                careInstructions: ["Rest in dark room", "Apply cold/warm compress", "Relaxation techniques", "Track triggers"]
            },
            stomach_pain: {
                condition: "Severe Stomach Pain",
                possibleCauses: ["Gastritis", "Peptic ulcer", "Appendicitis", "Gallstones", "Pancreatitis"],
                doctorType: "Gastroenterologist or General Practitioner",
                urgencyFactors: ["vomiting_blood", "severe_pain", "fever", "rigid_abdomen"],
                dietRecommendations: ["Clear liquids initially", "BRAT diet", "Avoid spicy/fatty foods", "Small frequent meals"],
                careInstructions: ["Rest", "Apply heat pad", "Avoid solid foods initially", "Monitor for worsening"]
            },
            high_fever: {
                condition: "High Fever",
                possibleCauses: ["Bacterial infection", "Viral infection", "Heat stroke", "Medication reaction"],
                doctorType: "General Practitioner (Emergency if >103°F)",
                urgencyFactors: ["temperature_over_103", "difficulty_breathing", "confusion"],
                dietRecommendations: ["Increased fluids", "Electrolyte solutions", "Light foods", "Avoid alcohol"],
                careInstructions: ["Cool compresses", "Tepid baths", "Light clothing", "Monitor temperature regularly"]
            },
            back_pain: {
                condition: "Back Pain",
                possibleCauses: ["Muscle strain", "Herniated disc", "Arthritis", "Kidney stones", "Osteoporosis"],
                doctorType: "Orthopedist or Physical Medicine Specialist",
                urgencyFactors: ["leg_numbness", "bladder_problems", "severe_pain"],
                dietRecommendations: ["Anti-inflammatory foods", "Calcium and Vitamin D", "Maintain healthy weight"],
                careInstructions: ["Gentle stretching", "Heat/ice therapy", "Proper posture", "Avoid bed rest beyond 2 days"]
            },
            joint_pain: {
                condition: "Joint Pain",
                possibleCauses: ["Arthritis", "Injury", "Gout", "Lupus", "Infection"],
                doctorType: "Rheumatologist or Orthopedist",
                urgencyFactors: ["red_swollen_joints", "fever", "inability_to_move"],
                dietRecommendations: ["Anti-inflammatory diet", "Omega-3 fatty acids", "Avoid purines if gout"],
                careInstructions: ["Rest affected joint", "Ice for acute injury", "Gentle range of motion", "Elevate if swollen"]
            },
            depression: {
                condition: "Persistent Sadness/Depression",
                possibleCauses: ["Major depression", "Seasonal depression", "Grief", "Medical conditions", "Medication side effects"],
                doctorType: "Psychiatrist or Psychologist",
                urgencyFactors: ["suicidal_thoughts", "self_harm", "inability_to_function"],
                dietRecommendations: ["Balanced diet", "Omega-3 rich foods", "Limit alcohol", "Regular meals"],
                careInstructions: ["Maintain routine", "Exercise regularly", "Social support", "Adequate sleep"]
            },
            anxiety: {
                condition: "Anxiety/Panic Attacks",
                possibleCauses: ["Generalized anxiety", "Panic disorder", "Stress", "Medical conditions"],
                doctorType: "Psychiatrist or Psychologist",
                urgencyFactors: ["chest_pain", "difficulty_breathing", "severe_panic"],
                dietRecommendations: ["Limit caffeine", "Avoid alcohol", "Regular meals", "Magnesium-rich foods"],
                careInstructions: ["Breathing exercises", "Mindfulness", "Regular exercise", "Stress management"]
            }
        };

        // Calculate Comprehensive Symptom Assessment
        function calculateSymptomAssessment(responses) {
            let urgencyScore = 0;
            let diagnosis = 'General assessment needed';
            let recommendations = [];
            let doctorType = 'General Practitioner';
            let dietAdvice = [];
            let careInstructions = [];
            let possibleConditions = [];

            // Get medical knowledge for specific symptom
            const specificSymptom = responses.specific_symptom;
            const medicalInfo = medicalKnowledge[specificSymptom] || {};

            if (medicalInfo.condition) {
                diagnosis = medicalInfo.condition;
                possibleConditions = medicalInfo.possibleCauses || [];
                doctorType = medicalInfo.doctorType || 'General Practitioner';
                dietAdvice = medicalInfo.dietRecommendations || [];
                careInstructions = medicalInfo.careInstructions || [];
            }

            // Calculate urgency score based on severity
            switch(responses.severity) {
                case 'critical':
                    urgencyScore += 8;
                    break;
                case 'severe':
                    urgencyScore += 5;
                    break;
                case 'moderate':
                    urgencyScore += 3;
                    break;
                case 'mild':
                    urgencyScore += 1;
                    break;
            }

            // Duration factors
            switch(responses.duration) {
                case 'less_6hours':
                    if (responses.severity === 'severe' || responses.severity === 'critical') urgencyScore += 2;
                    break;
                case '6_24hours':
                    urgencyScore += 1;
                    break;
                case 'more_1month':
                    urgencyScore += 2; // Chronic conditions need attention
                    break;
            }

            // Additional symptoms impact
            if (responses.additional_symptoms && responses.additional_symptoms !== 'none') {
                const additionalSymptoms = Array.isArray(responses.additional_symptoms) ? 
                    responses.additional_symptoms : [responses.additional_symptoms];
                
                additionalSymptoms.forEach(symptom => {
                    switch(symptom) {
                        case 'fever_chills':
                        case 'breathlessness':
                        case 'confusion':
                            urgencyScore += 2;
                            break;
                        case 'nausea':
                        case 'dizziness':
                        case 'fatigue':
                            urgencyScore += 1;
                            break;
                    }
                });
            }

            // Medical history considerations
            if (responses.medical_history && responses.medical_history !== 'none') {
                urgencyScore += 1;
                const conditions = Array.isArray(responses.medical_history) ? 
                    responses.medical_history : [responses.medical_history];
                
                conditions.forEach(condition => {
                    switch(condition) {
                        case 'heart_disease':
                        case 'diabetes':
                        case 'respiratory_disease':
                            urgencyScore += 1;
                            recommendations.push(`Monitor symptoms closely due to your ${condition.replace('_', ' ')} history`);
                            break;
                    }
                });
            }

            // Determine urgency level and actions
            let urgency, urgencyClass, actions;
            
            if (urgencyScore >= 10) {
                urgency = 'Critical Emergency';
                urgencyClass = 'urgency-emergency';
                actions = [
                    '🚨 Call emergency services immediately (108/102)',
                    '🏥 Go to nearest emergency room NOW',
                    '⚠️ Do NOT drive yourself - call ambulance',
                    '📞 Inform family members of your condition'
                ];
            } else if (urgencyScore >= 7) {
                urgency = 'Emergency';
                urgencyClass = 'urgency-emergency';
                actions = [
                    '🚨 Seek immediate medical attention',
                    '🏥 Visit emergency room within 1-2 hours',
                    '📞 Call emergency services if symptoms worsen',
                    '👥 Have someone accompany you'
                ];
            } else if (urgencyScore >= 4) {
                urgency = 'Urgent';
                urgencyClass = 'urgency-urgent';
                actions = [
                    '🏥 Consult a doctor within 24 hours',
                    '📞 Call your healthcare provider today',
                    '🔍 Monitor symptoms closely',
                    '📋 Keep a symptom diary'
                ];
            } else {
                urgency = 'Mild';
                urgencyClass = 'urgency-mild';
                actions = [
                    '🏠 Rest and self-care at home',
                    '💧 Stay well hydrated',
                    '📞 Consult doctor if symptoms persist >2-3 days',
                    '🔍 Monitor for any worsening'
                ];
            }

            return {
                diagnosis,
                urgency,
                urgencyClass,
                urgencyScore,
                actions,
                recommendations,
                doctorType,
                dietAdvice,
                careInstructions,
                possibleConditions
            };
        }

        // Display Comprehensive Diagnosis
        function displayDiagnosis(assessment) {
            const resultDiv = document.getElementById('diagnosisResult');
            
            // Build possible conditions list
            const possibleConditionsHtml = assessment.possibleConditions && assessment.possibleConditions.length > 0 ? `
                <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                    <strong>🩺 Possible Causes:</strong>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem; columns: 2; column-gap: 2rem;">
                        ${assessment.possibleConditions.map(cause => `<li style="margin: 0.25rem 0; break-inside: avoid;">${cause}</li>`).join('')}
                    </ul>
                </div>
            ` : '';
            
            // Build diet recommendations
            const dietAdviceHtml = assessment.dietAdvice && assessment.dietAdvice.length > 0 ? `
                <div style="margin: 1rem 0; padding: 1rem; background: #e8f5e8; border-radius: 6px; border-left: 4px solid #28a745;">
                    <strong>🍽️ Dietary Recommendations:</strong>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        ${assessment.dietAdvice.map(advice => `<li style="margin: 0.25rem 0;">${advice}</li>`).join('')}
                    </ul>
                </div>
            ` : '';
            
            // Build care instructions
            const careInstructionsHtml = assessment.careInstructions && assessment.careInstructions.length > 0 ? `
                <div style="margin: 1rem 0; padding: 1rem; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                    <strong>👩‍⚕️ Home Care Instructions:</strong>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        ${assessment.careInstructions.map(instruction => `<li style="margin: 0.25rem 0;">${instruction}</li>`).join('')}
                    </ul>
                </div>
            ` : '';
            
            // Build recommendations if any
            const recommendationsHtml = assessment.recommendations && assessment.recommendations.length > 0 ? `
                <div style="margin: 1rem 0; padding: 1rem; background: #d4edda; border-radius: 6px; border-left: 4px solid #155724;">
                    <strong>💡 Additional Recommendations:</strong>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        ${assessment.recommendations.map(rec => `<li style="margin: 0.25rem 0;">${rec}</li>`).join('')}
                    </ul>
                </div>
            ` : '';
            
            resultDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; text-align: center;">
                    <h3 style="margin: 0; font-size: 1.5rem;">🏥 AI Health Assessment Results</h3>
                    <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Comprehensive symptom analysis and medical guidance</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border-left: 4px solid #007bff;">
                        <strong>🩺 Condition Assessment:</strong>
                        <p style="margin: 0.5rem 0; font-size: 1.1rem; color: #0056b3;">${assessment.diagnosis}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border-left: 4px solid ${assessment.urgencyClass === 'urgency-emergency' ? '#dc3545' : assessment.urgencyClass === 'urgency-urgent' ? '#ffc107' : '#28a745'};">
                        <strong>⏱️ Urgency Level:</strong><br>
                        <span class="urgency-badge ${assessment.urgencyClass}" style="font-size: 1.1rem; margin-top: 0.5rem; display: inline-block;">${assessment.urgency}</span>
                    </div>
                </div>
                
                <div style="margin: 1.5rem 0; padding: 1rem; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <strong>👨‍⚕️ Recommended Specialist:</strong>
                    <p style="margin: 0.5rem 0; font-size: 1.1rem; color: #1565c0;">${assessment.doctorType}</p>
                </div>
                
                ${possibleConditionsHtml}
                
                <div style="margin: 1.5rem 0; padding: 1rem; background: ${assessment.urgencyClass === 'urgency-emergency' ? '#f8d7da' : assessment.urgencyClass === 'urgency-urgent' ? '#fff3cd' : '#d4edda'}; border-radius: 8px; border-left: 4px solid ${assessment.urgencyClass === 'urgency-emergency' ? '#dc3545' : assessment.urgencyClass === 'urgency-urgent' ? '#ffc107' : '#28a745'};">
                    <strong>🚨 Immediate Actions Needed:</strong>
                    <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        ${assessment.actions.map(action => `<li style="margin: 0.5rem 0; font-weight: 500;">${action}</li>`).join('')}
                    </ol>
                </div>
                
                ${dietAdviceHtml}
                ${careInstructionsHtml}
                ${recommendationsHtml}
                
                <div style="margin: 2rem 0; padding: 1.5rem; background: #f1f3f4; border-radius: 10px; border: 2px dashed #9e9e9e;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <span style="font-size: 2rem; margin-right: 1rem;">⚠️</span>
                        <strong style="color: #d32f2f; font-size: 1.2rem;">Important Medical Disclaimer</strong>
                    </div>
                    <p style="margin: 0; color: #424242; line-height: 1.6;">
                        This AI assessment is for <strong>educational and informational purposes only</strong> and should not be considered as professional medical advice, diagnosis, or treatment. 
                        Always consult with qualified healthcare professionals for proper medical evaluation and care. In case of emergency, call your local emergency services immediately.
                    </p>
                </div>
                
                <div style="text-align: center; margin: 1.5rem 0;">
                    <button onclick="startNewAssessment()" class="btn" style="background: #2E8B57; margin-right: 1rem;">
                        🔄 New Assessment
                    </button>
                    <button onclick="printResults()" class="btn" style="background: #6c757d;">
                        🖨️ Print Results
                    </button>
                </div>
            `;
            
            resultDiv.style.display = 'block';
            
            // Show emergency warning for high urgency
            if (assessment.urgency === 'Emergency' || assessment.urgency === 'Critical Emergency') {
                const emergencyDiv = document.getElementById('emergencyWarning');
                if (emergencyDiv) {
                    emergencyDiv.style.display = 'block';
                }
            }
            
            // Enhanced voice feedback
            if (aiVoiceEnabled) {
                let voiceMessage = `Assessment complete. Your condition is assessed as ${assessment.urgency.toLowerCase()}. `;
                if (assessment.urgencyClass === 'urgency-emergency') {
                    voiceMessage += 'This requires immediate medical attention. ';
                }
                voiceMessage += `I recommend consulting a ${assessment.doctorType.toLowerCase()}. `;
                voiceMessage += assessment.actions[0].replace(/�[�-��-�]|�[�-�]|�[�-�]|⚠️|⏱️/g, '');
                
                speakText(voiceMessage);
            }
            
            chatActive = false;
            
            // Scroll to results
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Additional helper functions
        function startNewAssessment() {
            // Reset and restart
            currentQuestion = 0;
            userResponses = {};
            document.getElementById('diagnosisResult').style.display = 'none';
            document.getElementById('emergencyWarning').style.display = 'none';
            document.getElementById('chatbotContainer').innerHTML = '';
            
            // Start new assessment
            setTimeout(() => {
                startSymptomChat();
            }, 500);
        }
        
        function printResults() {
            const printWindow = window.open('', '_blank');
            const resultContent = document.getElementById('diagnosisResult').innerHTML;
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>AI Health Assessment Results</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .urgency-badge { padding: 0.25rem 0.75rem; border-radius: 15px; font-weight: bold; }
                        .urgency-mild { background: #d4edda; color: #155724; }
                        .urgency-urgent { background: #fff3cd; color: #856404; }
                        .urgency-emergency { background: #f8d7da; color: #721c24; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <h1>AI Health Assessment Results</h1>
                    <p><strong>Generated on:</strong> ${new Date().toLocaleString()}</p>
                    ${resultContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // Enhanced Voice Recognition Functions with Conversational AI
        let conversationContext = {
            awaitingResponse: false,
            currentQuestionType: null,
            partialResponses: {},
            conversationFlow: 'initial'
        };

        function toggleVoiceRecording() {
            console.log('toggleVoiceRecording called');
            
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showStatusMessage('Speech recognition not supported in this browser. Please try Chrome or Edge.', 'error');
                speakText('Sorry, speech recognition is not supported in this browser. Please try using Chrome or Edge.');
                return;
            }

            if (isRecording) {
                stopVoiceRecording();
            } else {
                startVoiceRecording();
            }
        }

        function startVoiceRecording() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            voiceRecognition = new SpeechRecognition();
            
            // Enhanced settings for better recognition
            voiceRecognition.continuous = true;
            voiceRecognition.interimResults = true;
            voiceRecognition.lang = currentLanguage === 'hi' ? 'hi-IN' : currentLanguage === 'te' ? 'te-IN' : 'en-US';
            voiceRecognition.maxAlternatives = 3;

            let finalTranscript = '';
            let interimTranscript = '';

            voiceRecognition.onstart = function() {
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                const voiceText = document.getElementById('voiceText');
                if (voiceBtn) voiceBtn.classList.add('recording');
                if (voiceText) voiceText.textContent = 'Listening...';
                
                showStatusMessage('🎤 Listening... Speak clearly!', 'success');
                
                // Visual feedback
                createVoiceVisualizer();
            };

            voiceRecognition.onresult = function(event) {
                finalTranscript = '';
                interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                // Show interim results
                updateVoicePreview(finalTranscript + interimTranscript);
                
                // Process final transcript
                if (finalTranscript) {
                    processVoiceInput(finalTranscript.trim());
                    finalTranscript = '';
                }
            };

            voiceRecognition.onerror = function(event) {
                let errorMessage = 'Voice recognition error: ';
                switch(event.error) {
                    case 'network':
                        errorMessage += 'Network connection issue';
                        break;
                    case 'not-allowed':
                        errorMessage += 'Microphone access denied. Please allow microphone permissions.';
                        break;
                    case 'no-speech':
                        errorMessage += 'No speech detected. Please speak clearly.';
                        break;
                    default:
                        errorMessage += event.error;
                }
                showStatusMessage(errorMessage, 'error');
                stopVoiceRecording();
            };

            voiceRecognition.onend = function() {
                if (isRecording) {
                    // Auto-restart if user is still speaking
                    setTimeout(() => {
                        if (isRecording) voiceRecognition.start();
                    }, 100);
                }
            };

            voiceRecognition.start();
        }

        function stopVoiceRecording() {
            if (voiceRecognition) {
                voiceRecognition.stop();
            }
            isRecording = false;
            
            const voiceBtn = document.getElementById('voiceBtn');
            const voiceText = document.getElementById('voiceText');
            if (voiceBtn) voiceBtn.classList.remove('recording');
            if (voiceText) voiceText.textContent = 'Speak Your Symptoms';
            
            removeVoiceVisualizer();
            clearVoicePreview();
        }

        // Process voice input with conversational AI
        function processVoiceInput(transcript) {
            console.log('Processing voice input:', transcript);
            
            addChatMessage('user', `🎤 "${transcript}"`);
            
            // Stop current recording to process
            stopVoiceRecording();
            
            // Show processing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                if (!chatActive) {
                    // Handle general conversation
                    handleGeneralConversation(transcript);
                } else {
                    // Handle symptom assessment responses
                    handleSymptomResponse(transcript);
                }
            }, 1000);
        }

        // Handle general conversation outside symptom assessment
        function handleGeneralConversation(transcript) {
            const lowerTranscript = transcript.toLowerCase();
            
            if (lowerTranscript.includes('start') || lowerTranscript.includes('begin') || 
                lowerTranscript.includes('symptom') || lowerTranscript.includes('check') ||
                lowerTranscript.includes('health')) {
                
                addChatMessage('ai', 'Perfect! I\'ll help you with your symptom assessment. Let me start by asking you a few questions.');
                speakText('Perfect! I will help you with your symptom assessment. Let me start by asking you a few questions.');
                
                setTimeout(() => {
                    startSymptomChat();
                }, 2000);
                
            } else if (lowerTranscript.includes('hello') || lowerTranscript.includes('hi')) {
                const greeting = 'Hello! I\'m your AI health assistant. I can help you assess your symptoms and provide medical guidance. Would you like to start a symptom check?';
                addChatMessage('ai', greeting);
                speakText(greeting);
                
            } else if (lowerTranscript.includes('help')) {
                const helpMessage = 'I can help you with symptom assessment, provide health advice, and guide you to appropriate medical care. You can speak to me naturally or click buttons. What would you like to know?';
                addChatMessage('ai', helpMessage);
                speakText(helpMessage);
                
            } else {
                const fallbackMessage = 'I understand you said "' + transcript + '". I\'m here to help with your health concerns. Would you like to start a symptom assessment, or do you have a specific question about your health?';
                addChatMessage('ai', fallbackMessage);
                speakText('I understand. I am here to help with your health concerns. Would you like to start a symptom assessment?');
            }
        }

        // Handle voice responses during symptom assessment
        function handleSymptomResponse(transcript) {
            const currentQ = symptomQuestions[currentQuestion];
            if (!currentQ) return;
            
            const lowerTranscript = transcript.toLowerCase();
            let matchedOption = null;
            let confidence = 0;
            
            // Try to match transcript with available options
            currentQ.options.forEach(option => {
                const optionText = option.text.toLowerCase().replace(/[🎤🔥🩺👁️👂🩸🧠❤️🫁🍽️🦴🌡️👶💊⏰📅🤢💫😴😊😐😰🚨✋]/g, '');
                const keywords = optionText.split(/[\s,\-()]/g).filter(word => word.length > 2);
                
                let matches = 0;
                keywords.forEach(keyword => {
                    if (lowerTranscript.includes(keyword.toLowerCase())) {
                        matches++;
                    }
                });
                
                const currentConfidence = matches / keywords.length;
                if (currentConfidence > confidence && currentConfidence > 0.3) {
                    confidence = currentConfidence;
                    matchedOption = option;
                }
            });
            
            if (matchedOption) {
                // Found a match
                selectOption(matchedOption.value, matchedOption.text);
                
                const confirmMessage = `I understood: ${matchedOption.text}. Let me ask you the next question.`;
                addChatMessage('ai', confirmMessage);
                speakText(confirmMessage);
                
            } else {
                // No clear match found, ask for clarification
                const clarificationMessage = `I heard "${transcript}" but I\'m not sure which option you meant. Let me repeat the options for you.`;
                addChatMessage('ai', clarificationMessage);
                speakText(clarificationMessage);
                
                // Re-ask the question
                setTimeout(() => {
                    askQuestion(currentQuestion);
                }, 2000);
            }
        }

        // Create voice visualizer for better UX
        function createVoiceVisualizer() {
            const container = document.getElementById('chatbotContainer');
            if (!container || document.getElementById('voiceVisualizer')) return;
            
            const visualizer = document.createElement('div');
            visualizer.id = 'voiceVisualizer';
            visualizer.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; padding: 1rem; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); border-radius: 10px; margin: 1rem 0; animation: pulse 1.5s infinite;">
                    <div style="width: 20px; height: 20px; background: white; border-radius: 50%; margin: 0 5px; animation: bounce 1s infinite;" data-delay="0"></div>
                    <div style="width: 20px; height: 20px; background: white; border-radius: 50%; margin: 0 5px; animation: bounce 1s infinite;" data-delay="0.2s"></div>
                    <div style="width: 20px; height: 20px; background: white; border-radius: 50%; margin: 0 5px; animation: bounce 1s infinite;" data-delay="0.4s"></div>
                    <span style="color: white; font-weight: bold; margin-left: 15px;">🎤 Listening...</span>
                </div>
            `;
            container.appendChild(visualizer);
        }

        function removeVoiceVisualizer() {
            const visualizer = document.getElementById('voiceVisualizer');
            if (visualizer) {
                visualizer.remove();
            }
        }

        // Show voice preview of what user is saying
        function updateVoicePreview(text) {
            let preview = document.getElementById('voicePreview');
            if (!preview) {
                const container = document.getElementById('chatbotContainer');
                preview = document.createElement('div');
                preview.id = 'voicePreview';
                preview.style.cssText = 'background: #f0f8ff; border: 2px dashed #4a90e2; padding: 10px; margin: 10px 0; border-radius: 8px; font-style: italic; color: #666;';
                container.appendChild(preview);
            }
            preview.innerHTML = `🎤 "${text}"<span style="animation: blink 1s infinite;">|</span>`;
        }

        function clearVoicePreview() {
            const preview = document.getElementById('voicePreview');
            if (preview) {
                preview.remove();
            }
        }

        // Enhanced Text-to-Speech Functions with Multi-language Support
        let currentVoice = null;
        let voicesLoaded = false;
        
        // Load and cache voices
        function loadVoices() {
            return new Promise((resolve) => {
                const voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    voicesLoaded = true;
                    resolve(voices);
                } else {
                    speechSynthesis.onvoiceschanged = () => {
                        voicesLoaded = true;
                        resolve(speechSynthesis.getVoices());
                    };
                }
            });
        }

        function toggleTextToSpeech() {
            aiVoiceEnabled = !aiVoiceEnabled;
            const speakBtn = document.getElementById('speakText');
            if (speakBtn) {
                speakBtn.textContent = aiVoiceEnabled ? '🔊 AI Voice: ON' : '🔇 AI Voice: OFF';
                speakBtn.style.background = aiVoiceEnabled ? '#28a745' : '#6c757d';
            }
            
            if (!aiVoiceEnabled) {
                speechSynthesis.cancel(); // Stop any current speech
            } else {
                // Test voice when enabled
                speakText('AI voice is now enabled. I will speak my responses to help you.');
            }
            
            showStatusMessage(`AI Voice ${aiVoiceEnabled ? 'enabled' : 'disabled'}`, 'success');
        }

        async function speakText(text) {
            if (!aiVoiceEnabled || !speechSynthesis || !text) return;
            
            speechSynthesis.cancel(); // Cancel any ongoing speech
            
            // Clean text for better speech
            const cleanText = text
                .replace(/[🎤🔥🩺👁️👂🩸🧠❤️🫁🍽️🦴🌡️👶💊⏰📅🤢💫😴😊😐😰🚨✋🏥📞👥🔍📋🏠💧⚠️⏱️👨‍⚕️👩‍⚕️💡🔄🖨️]/g, '') // Remove emojis
                .replace(/\*\*([^*]+)\*\*/g, '$1') // Remove bold markdown
                .replace(/\*([^*]+)\*/g, '$1') // Remove italic markdown
                .replace(/([.!?])\s*([A-Z])/g, '$1 $2') // Add pauses between sentences
                .trim();
            
            if (!cleanText) return;
            
            const utterance = new SpeechSynthesisUtterance(cleanText);
            
            // Enhanced voice settings
            utterance.rate = 0.85; // Slightly slower for better comprehension
            utterance.pitch = 1.1; // Slightly higher pitch for friendliness
            utterance.volume = 0.9;
            
            // Load voices if not already loaded
            const voices = await loadVoices();
            
            // Select voice based on current language
            let selectedVoice = null;
            
            if (currentLanguage === 'hi') {
                // Look for Hindi voice
                selectedVoice = voices.find(voice => 
                    voice.lang.includes('hi') || 
                    voice.lang.includes('Hindi') ||
                    (voice.name.toLowerCase().includes('hindi'))
                );
            } else if (currentLanguage === 'te') {
                // Look for Telugu voice
                selectedVoice = voices.find(voice => 
                    voice.lang.includes('te') || 
                    voice.lang.includes('Telugu') ||
                    (voice.name.toLowerCase().includes('telugu'))
                );
            }
            
            // Fallback to English voices
            if (!selectedVoice) {
                // Prefer female voices for healthcare context
                selectedVoice = voices.find(voice => 
                    voice.lang.includes('en') && (
                        voice.name.toLowerCase().includes('female') ||
                        voice.name.toLowerCase().includes('samantha') ||
                        voice.name.toLowerCase().includes('karen') ||
                        voice.name.toLowerCase().includes('susan') ||
                        voice.name.toLowerCase().includes('allison') ||
                        voice.name.toLowerCase().includes('zira')
                    )
                );
                
                // If no female voice, use any English voice
                if (!selectedVoice) {
                    selectedVoice = voices.find(voice => 
                        voice.lang.includes('en-US') || 
                        voice.lang.includes('en-GB') ||
                        voice.lang.includes('en')
                    );
                }
            }
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
                currentVoice = selectedVoice;
                console.log('Using voice:', selectedVoice.name, selectedVoice.lang);
            }
            
            // Add event listeners for better control
            utterance.onstart = function() {
                console.log('Speech started');
                // Visual indicator that AI is speaking
                showSpeakingIndicator();
            };
            
            utterance.onend = function() {
                console.log('Speech ended');
                hideSpeakingIndicator();
            };
            
            utterance.onerror = function(event) {
                console.error('Speech error:', event.error);
                hideSpeakingIndicator();
                if (event.error === 'not-allowed') {
                    showStatusMessage('Speech synthesis not allowed. Please check browser settings.', 'error');
                }
            };
            
            // Speak with a slight delay to ensure voice is loaded
            setTimeout(() => {
                speechSynthesis.speak(utterance);
            }, 100);
        }
        
        // Voice selection utility
        function selectVoice(voiceName) {
            loadVoices().then(voices => {
                const voice = voices.find(v => v.name === voiceName);
                if (voice) {
                    currentVoice = voice;
                    showStatusMessage(`Voice changed to: ${voice.name}`, 'success');
                    speakText('Voice changed successfully. This is how I sound now.');
                }
            });
        }
        
        // Visual indicators for speech
        function showSpeakingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'speakingIndicator';
            indicator.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 80px; 
                    right: 20px; 
                    background: linear-gradient(45deg, #ff6b6b, #4ecdc4); 
                    color: white; 
                    padding: 10px 20px; 
                    border-radius: 25px; 
                    font-weight: bold;
                    animation: pulse 1.5s infinite;
                    z-index: 1002;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                ">
                    🔊 AI Speaking...
                </div>
            `;
            document.body.appendChild(indicator);
        }
        
        function hideSpeakingIndicator() {
            const indicator = document.getElementById('speakingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Utility Functions
        function restartChat() {
            currentQuestion = 0;
            chatActive = false;
            userResponses = {};
            
            // Reset UI
            document.getElementById('chatOptions').style.display = 'none';
            document.getElementById('diagnosisResult').style.display = 'none';
            document.getElementById('emergencyWarning').style.display = 'none';
            
            // Reset chat container
            const container = document.getElementById('chatbotContainer');
            container.innerHTML = `
                <div class="chat-message ai">
                    <div class="message-avatar ai-avatar">🤖</div>
                    <div class="message-bubble ai">
                        Welcome back to CSE-D AI Symptom Checker! Click "Start Symptom Check" to begin a new assessment.
                    </div>
                </div>
            `;
            
            showStatusMessage('Chat reset. Ready for new assessment!', 'success');
        }

        function bookConsultation() {
            showStatusMessage('Redirecting to consultation booking...', 'success');
            alert('Consultation Booking:\n\nThis feature would connect you with available doctors.\n\nFor now, please use the Patient Portal to register and request a consultation.');
            // Could redirect to patient portal or specific booking page
        }
        
        // Make all symptom checker functions globally accessible
        window.toggleVoiceRecording = toggleVoiceRecording;
        window.toggleTextToSpeech = toggleTextToSpeech;
        window.restartChat = restartChat;
        window.bookConsultation = bookConsultation;

        // Search medicine
        function searchMedicine() {
            const searchTerm = document.getElementById('medicineSearch').value;
            const resultsDiv = document.getElementById('medicineResults');
            
            if (!searchTerm) {
                showStatusMessage('Please enter a medicine name', 'error');
                return;
            }

            // Show search results (using existing mock data)
            resultsDiv.style.display = 'block';
            showStatusMessage(`Searched for: ${searchTerm}`, 'success');

            console.log('Medicine searched:', searchTerm);
        }

        // Call emergency
        function callEmergency(number) {
            if (confirm(`Call emergency number ${number}?`)) {
                showStatusMessage(`Calling ${number}...`, 'success');
                // In real app, this would initiate the call
                window.open(`tel:${number}`);
            }
        }

        // Show status message
        function showStatusMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // Government Schemes Functions
        function checkEligibility(scheme) {
            let message = '';
            switch(scheme) {
                case 'ayushman':
                    message = 'Ayushman Bharat Eligibility Check:\n\nYou need:\n• Ration card (BPL/APL)\n• Aadhaar card\n• Family income certificate\n\nVisit: Civil Hospital Nabha or call 14555';
                    break;
                default:
                    message = 'Eligibility information will be displayed here.';
            }
            alert(message);
            showStatusMessage(`Checked eligibility for ${scheme}`, 'success');
        }
        
        function findHospital(scheme) {
            showStatusMessage('Finding nearby hospitals...', 'success');
            alert('Nearby Hospitals for ' + scheme + ':\n\n1. Civil Hospital Nabha - 2.5 km\n2. Patiala Medical College - 45 km\n3. Rajindra Hospital - 48 km');
        }
        
        function findCenter(scheme) {
            showStatusMessage('Finding health centers...', 'success');
            alert('Nearby Health Centers:\n\n1. PHC Nabha - 1 km\n2. CHC Samana - 15 km\n3. District Hospital Patiala - 45 km');
        }
        
        function downloadCard(scheme) {
            showStatusMessage('Generating health card...', 'success');
            alert('Health card download initiated. You will receive SMS with download link.');
        }
        
        function findStore(scheme) {
            showStatusMessage('Finding Jan Aushadhi stores...', 'success');
            alert('Jan Aushadhi Stores:\n\n1. Nabha Main Market - 0.8 km\n2. Civil Hospital Campus - 2.5 km\n3. Bus Stand Road - 1.2 km');
        }
        
        function comparePrices() {
            showStatusMessage('Loading price comparison...', 'success');
            alert('Medicine Price Comparison:\n\nParacetamol 500mg:\n• Branded: ₹45\n• Jan Aushadhi: ₹8\n• Savings: 82%\n\nAmoxicillin 250mg:\n• Branded: ₹120\n• Jan Aushadhi: ₹25\n• Savings: 79%');
        }
        
        function trackAmbulance() {
            showStatusMessage('Tracking ambulance...', 'success');
            alert('Ambulance Status:\n\nNearest ambulance: PB-10-AB-1234\nLocation: 5 km away\nETA: 12 minutes\n\nDriver: Rajesh Kumar\nPhone: +91 98765-11108');
        }
        
        // Emergency Functions
        function shareLocation() {
            showStatusMessage('Getting location...', 'success');
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    showStatusMessage(`Location shared: ${lat.toFixed(6)}, ${lon.toFixed(6)}`, 'success');
                    alert(`Your location has been shared with emergency services:\n\nLatitude: ${lat.toFixed(6)}\nLongitude: ${lon.toFixed(6)}\n\nEmergency services have been notified.`);
                }, function() {
                    showStatusMessage('Location access denied', 'error');
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        
        function reportFire() {
            showStatusMessage('Reporting fire emergency...', 'success');
            alert('Fire Emergency Report:\n\nYour report has been filed.\nFire department has been notified.\nReference ID: FIRE-' + Date.now().toString().slice(-6));
        }
        
        function findShelter() {
            showStatusMessage('Finding emergency shelters...', 'success');
            alert('Emergency Shelters:\n\n1. Community Center Nabha - 2 km\n2. Government School - 1.5 km\n3. Gurudwara Sahib - 3 km\n\nAll shelters have basic facilities and are open 24/7.');
        }
        
        function getCurrentLocation() {
            const locationDisplay = document.getElementById('locationDisplay');
            locationDisplay.innerHTML = '<p style="margin: 0; color: #666;">Getting your location...</p>';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    locationDisplay.innerHTML = `
                        <p style="margin: 0;"><strong>Your Location:</strong></p>
                        <p style="margin: 0.5rem 0;">📍 Latitude: ${lat.toFixed(6)}</p>
                        <p style="margin: 0.5rem 0;">📍 Longitude: ${lon.toFixed(6)}</p>
                        <p style="margin: 0.5rem 0; color: #28a745;">✅ Location ready to share with emergency services</p>
                    `;
                    showStatusMessage('Location obtained successfully', 'success');
                }, function() {
                    locationDisplay.innerHTML = '<p style="margin: 0; color: #dc3545;">❌ Unable to get location. Please check your browser permissions.</p>';
                    showStatusMessage('Location access denied', 'error');
                });
            } else {
                locationDisplay.innerHTML = '<p style="margin: 0; color: #dc3545;">❌ Geolocation is not supported by this browser.</p>';
            }
        }
        
        function sendLocationSMS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const message = `Emergency Location: https://maps.google.com/maps?q=${lat},${lon}`;
                    const phone = prompt('Enter emergency contact number:', '+91');
                    if (phone) {
                        showStatusMessage(`Location SMS prepared for ${phone}`, 'success');
                        alert(`SMS ready to send to ${phone}:\n\n${message}\n\n(In real app, SMS would be sent automatically)`);
                    }
                }, function() {
                    showStatusMessage('Location access required for SMS', 'error');
                });
            }
        }

        // Initialize language selector event listener
        document.addEventListener('DOMContentLoaded', function() {
            const languageSelect = document.getElementById('languageSelect');
            if (languageSelect) {
                languageSelect.addEventListener('change', function() {
                    changeLanguage(this.value);
                });
                
                // Set default language
                changeLanguage('en');
                console.log('Language selector initialized');
            }
        });

        console.log('Nabha Telemedicine MVP loaded successfully!');
    </script>
</body>
</html>